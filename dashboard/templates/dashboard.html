<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybersecurity Threat Detection Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .status-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .status-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .status-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .status-healthy { border-left: 4px solid #10b981; }
        .status-warning { border-left: 4px solid #f59e0b; }
        .status-critical { border-left: 4px solid #ef4444; }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .panel h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 2px solid #f3f4f6;
            padding-bottom: 10px;
        }
        
        .alert-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .alert-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .alert-high {
            background: #fee2e2;
            border-left-color: #ef4444;
        }
        
        .alert-medium {
            background: #fef3c7;
            border-left-color: #f59e0b;
        }
        
        .alert-low {
            background: #dbeafe;
            border-left-color: #3b82f6;
        }
        
        .alert-item h4 {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .alert-item p {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .timestamp {
            font-size: 11px;
            color: #999;
        }
        
        .threat-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #f9fafb;
            border-radius: 6px;
            border-left: 3px solid #ef4444;
        }
        
        .threat-item .threat-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .threat-item .source {
            font-weight: bold;
            color: #333;
        }
        
        .threat-item .confidence {
            color: #ef4444;
            font-weight: bold;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge-high { background: #fee2e2; color: #991b1b; }
        .badge-medium { background: #fef3c7; color: #92400e; }
        .badge-low { background: #dbeafe; color: #1e3a8a; }
        .badge-info { background: #f3f4f6; color: #374151; }
        
        .chart-placeholder {
            height: 300px;
            background: #f9fafb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 14px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        .refresh-btn {
            background: #10b981;
        }
        
        .refresh-btn:hover {
            background: #059669;
        }
        
        .clear-btn {
            background: #ef4444;
        }
        
        .clear-btn:hover {
            background: #dc2626;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #9ca3af;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è AI-Driven Cybersecurity Threat Detection Dashboard</h1>
            <p class="subtitle">Real-time monitoring and threat intelligence | Last updated: <span id="last-update">--</span></p>
        </header>
        
        <div class="status-bar">
            <div class="status-card" id="system-status">
                <h3>System Status</h3>
                <div class="value">--</div>
            </div>
            <div class="status-card">
                <h3>Total Analyzed</h3>
                <div class="value" id="total-analyzed">0</div>
            </div>
            <div class="status-card">
                <h3>Threats Detected</h3>
                <div class="value" id="threats-detected" style="color: #ef4444;">0</div>
            </div>
            <div class="status-card">
                <h3>Threat Rate</h3>
                <div class="value" id="threat-rate">0%</div>
            </div>
            <div class="status-card">
                <h3>High Severity</h3>
                <div class="value" id="high-severity" style="color: #ef4444;">0</div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="panel">
                <h2>üö® Active Security Alerts</h2>
                <div id="alerts-container" class="alert-list">
                    <div class="loading pulse">Loading alerts...</div>
                </div>
                <button class="refresh-btn" onclick="loadAlerts()">Refresh Alerts</button>
                <button class="clear-btn" onclick="clearDashboard()">Clear All</button>
            </div>
            
            <div class="panel">
                <h2>üî¥ Live Threat Feed</h2>
                <div id="threats-container" class="alert-list">
                    <div class="loading pulse">Loading threats...</div>
                </div>
                <button class="refresh-btn" onclick="loadThreats()">Refresh Feed</button>
            </div>
        </div>
        
        <div class="panel">
            <h2>üìä Threat Intelligence Report</h2>
            <div id="report-container">
                <div class="loading pulse">Loading report...</div>
            </div>
            <button class="refresh-btn" onclick="loadReport()">Generate Report</button>
        </div>
    </div>
    
    <script>
        let refreshInterval;
        
        // Auto-refresh every 5 seconds
        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                loadDashboardData();
            }, 5000);
        }
        
        // Load all dashboard data
        function loadDashboardData() {
            loadStatus();
            loadAlerts();
            loadThreats();
            loadReport();
        }
        
        // Load system status
        async function loadStatus() {
            try {
                const response = await fetch('/api/dashboard/status');
                const data = await response.json();
                
                // Update status card
                const statusCard = document.getElementById('system-status');
                statusCard.classList.remove('status-healthy', 'status-warning', 'status-critical');
                statusCard.classList.add(`status-${data.status}`);
                statusCard.querySelector('.value').textContent = data.status.toUpperCase();
                
                // Update statistics
                const stats = data.statistics;
                document.getElementById('total-analyzed').textContent = stats.total_analyzed || 0;
                document.getElementById('threats-detected').textContent = stats.threat_count || 0;
                document.getElementById('threat-rate').textContent = stats.threat_rate || '0%';
                document.getElementById('high-severity').textContent = stats.high_severity_threats || 0;
                
                // Update timestamp
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error loading status:', error);
            }
        }
        
        // Load alerts
        async function loadAlerts() {
            try {
                const response = await fetch('/api/dashboard/alerts?limit=10');
                const data = await response.json();
                
                const container = document.getElementById('alerts-container');
                
                if (data.alerts && data.alerts.length > 0) {
                    container.innerHTML = data.alerts.map(item => {
                        const alert = item.alert;
                        const summary = item.ai_summary;
                        const severity = alert.severity.toLowerCase();
                        
                        return `
                            <div class="alert-item alert-${severity}">
                                <h4>üö® ${summary.title || alert.message}</h4>
                                <p><strong>Source:</strong> ${alert.source_ip || 'Unknown'} ‚Üí ${alert.destination_ip || 'Unknown'}</p>
                                <p><strong>Confidence:</strong> ${(alert.confidence * 100).toFixed(1)}%</p>
                                <p><strong>Attack Type:</strong> ${summary.attack_type || 'Unknown'}</p>
                                <span class="badge badge-${severity}">${alert.severity}</span>
                                <span class="timestamp">${new Date(alert.timestamp).toLocaleString()}</span>
                            </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = '<div class="no-data">‚úÖ No active alerts. System is secure.</div>';
                }
            } catch (error) {
                console.error('Error loading alerts:', error);
                document.getElementById('alerts-container').innerHTML = '<div class="no-data">Error loading alerts</div>';
            }
        }
        
        // Load live threats
        async function loadThreats() {
            try {
                const response = await fetch('/api/dashboard/threats/live');
                const data = await response.json();
                
                const container = document.getElementById('threats-container');
                
                if (data.threats && data.threats.length > 0) {
                    container.innerHTML = data.threats.map(threat => {
                        return `
                            <div class="threat-item">
                                <div class="threat-header">
                                    <span class="source">${threat.input_data?.source_ip || 'Unknown'}</span>
                                    <span class="confidence">${(threat.confidence * 100).toFixed(1)}%</span>
                                </div>
                                <p style="font-size: 12px; color: #666;">
                                    Target: ${threat.input_data?.destination_ip || 'Unknown'}:${threat.input_data?.destination_port || '?'}
                                </p>
                                <span class="badge badge-${threat.severity.toLowerCase()}">${threat.severity}</span>
                            </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = '<div class="no-data">No recent threats detected</div>';
                }
            } catch (error) {
                console.error('Error loading threats:', error);
                document.getElementById('threats-container').innerHTML = '<div class="no-data">Error loading threats</div>';
            }
        }
        
        // Load intelligence report
        async function loadReport() {
            try {
                const response = await fetch('/api/dashboard/report');
                const data = await response.json();
                
                const container = document.getElementById('report-container');
                
                if (data.summary) {
                    const summary = data.summary;
                    container.innerHTML = `
                        <div style="background: #f9fafb; padding: 20px; border-radius: 8px;">
                            <pre style="white-space: pre-wrap; font-family: inherit; margin-bottom: 15px;">${summary.executive_summary}</pre>
                            
                            <h3 style="margin-top: 20px; margin-bottom: 10px;">üìã Recommendations</h3>
                            <ul style="margin-left: 20px;">
                                ${data.recommendations.map(rec => `<li style="margin-bottom: 8px;">${rec}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                } else {
                    container.innerHTML = '<div class="no-data">No data available for report generation</div>';
                }
            } catch (error) {
                console.error('Error loading report:', error);
                document.getElementById('report-container').innerHTML = '<div class="no-data">Error loading report</div>';
            }
        }
        
        // Clear dashboard
        async function clearDashboard() {
            if (!confirm('Are you sure you want to clear all dashboard data?')) {
                return;
            }
            
            try {
                await fetch('/api/dashboard/clear', { method: 'POST' });
                loadDashboardData();
                alert('Dashboard cleared successfully');
            } catch (error) {
                console.error('Error clearing dashboard:', error);
                alert('Error clearing dashboard');
            }
        }
        
        // Initialize dashboard
        window.onload = () => {
            loadDashboardData();
            startAutoRefresh();
        };
        
        // Cleanup on page unload
        window.onbeforeunload = () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        };
    </script>
</body>
</html>
